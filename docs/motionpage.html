<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Motion</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="rack.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rack-logo-110x55.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Sections</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Motion </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="motion"></a>
Motion</h1>
<p>In radar meteorologically, motion can be divided to two phenomenon: atmospheric motion, which is motion of air and falling hydrometeors, and motion of precipitation area, which can be further divided into motion of convective and stratiform areas, for example. <b>Rack</b> is capable of detecting both of them.</p>
<h2><a class="anchor" id="doppler"></a>
Basic Doppler products</h2>
<p>Weather radars capable of measuring Doppler speed produce hydrometeor velocities projected on the beam &ndash; hence one-dimensional. The obtained speeds are further aliased by the maximum unambiguous velocity, <img class="formulaInl" alt="$ V_{Nyq} $" src="form_48.png"/>. In the following, two derived products by are presented.</p>
<h2><a class="anchor" id="dopplerAvg"></a>
Doppler wind smoothing</h2>
<p>The Doppler field can be smoothed with <code>&ndash;pDopplerAvg</code> command:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --pDopplerAvg 5000 -o dopplerAvg.h5</div></div><!-- fragment --><p> There are several parameters, determining the window width and height, minimum percentage for the samples in the window, switch for compensating the beam broadening, as well as switch for scaling the result with maximum unambiguous speed <img class="formulaInl" alt="$V_{Nyq}$" src="form_49.png"/> (stored as <code>how:NI</code> in ODIM metadata): </p><div class="fragment"><div class="line">   width=1500 [metres]</div><div class="line">   height=3 [deg]</div><div class="line">   threshold=0.5 [percentage]</div><div class="line">   compensate=<span class="keyword">false</span> [cart/polar[0|1]]</div><div class="line">   relativeScale=<span class="keyword">false</span> [[<span class="keyword">false</span>|<span class="keyword">true</span>]]</div></div><!-- fragment --><div class="image">
<img src="pDopplerAvg-panel.png" alt="pDopplerAvg-panel.png"/>
<div class="caption">
Raw Doppler data (left) and averaged data (right).</div></div>
 <p>There is also experimental commands <code>&ndash;pDopplerAvg2</code> and <code>&ndash;pDopplerAvgExp</code> .</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --pDopplerAvg2 5000 -o dopplerAvg2.h5</div></div><!-- fragment --><div class="image">
<img src="pDopplerAvg2-panel.png" alt="pDopplerAvg2-panel.png"/>
<div class="caption">
Raw Doppler data (left) and averaged data (right).</div></div>
 <p>It is recommended to use at least 16-bit resolution to store averaged fields.</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --pDopplerAvgExp 0.5,vertExtension=80 -o dopplerAvgExp.h5</div></div><!-- fragment --><div class="image">
<img src="pDopplerAvgExp-panel.png" alt="pDopplerAvgExp-panel.png"/>
<div class="caption">
Raw Doppler data (left) and averaged data (right).</div></div>
 <h2><a class="anchor" id="dopplerDev"></a>
Doppler wind variation</h2>
<p>The standard deviation in Doppler field can be displayed with <code>&ndash;pDopplerDev</code> command:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --pDopplerDev <span class="stringliteral">&#39;1500,3,0.5,false,true&#39;</span> -o dopplerDev.h5</div></div><!-- fragment --><p> The parameters are the same as in the Doppler averaging above: </p><div class="fragment"><div class="line">   width=1500 [metres]</div><div class="line">   height=3 [deg]</div><div class="line">   threshold=0.5 [percentage]</div><div class="line">   compensate=<span class="keyword">false</span> [cart/polar[0|1]]</div><div class="line">   relativeScale=<span class="keyword">true</span> [<span class="keyword">true</span>|<span class="keyword">false</span>]</div></div><!-- fragment --><div class="image">
<img src="pDopplerDev-panel.png" alt="pDopplerDev-panel.png"/>
<div class="caption">
Raw Doppler data (left) and standard deviation (right).</div></div>
 <p>See also the corresponding anomaly detector: <a class="el" href="andrepage.html#aDopplerNoise">Detecting noise in Doppler wind</a> .</p>
<h2><a class="anchor" id="dopplerinv"></a>
Deriving two-dimensional wind field from Doppler data</h2>
<div class="fragment"><div class="line">--pDopplerInversion  &lt;width&gt;,&lt;height&gt;,&lt;altitudeWeight&gt;</div><div class="line">  Derives 2D wind (u,v) from aliased Doppler data.</div><div class="line">    width=500 [metres]</div><div class="line">    height=3 [degrees]</div><div class="line">    altitudeWeight= [Functor:a:b:c...]</div></div><!-- fragment --><p>Basic usage creates polar products, ie. a resulting array is in polar coordinates: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-widespread.h5 --pDopplerInversion 2500,90  -o amv-polar.h5</div></div><!-- fragment --><p>The vector field can be stored in text format to as follows: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-widespread.h5 --pDopplerInversion 2500,90 --sample 30,30,skipVoid=1 --format <span class="stringliteral">&#39;${LON} ${LAT} ${AMVU} ${AMVV} ${QIND}&#39;</span> -o amv-polar.dat</div></div><!-- fragment --><p> The filename has to have "dat" as extension. See <a class="el" href="miscbook.html#sampling">Sampling grid data</a> for further instructions of using <code>&ndash;sample</code>. The output (truncated in the middle) is as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># proj=&#39; +proj=aeqd +lon_0=23.0764 +lat_0=61.7673 +ellps=WGS84&#39;</span></div><div class="line"><span class="preprocessor"># bbox=&#39;23.0765,64.9391,23.0764,64.9391&#39;</span></div><div class="line"><span class="preprocessor"># size=&#39;500x360&#39;</span></div><div class="line"><span class="preprocessor"># iStep=30</span></div><div class="line"><span class="preprocessor"># jStep=30</span></div><div class="line"><span class="preprocessor"># sampleRows=16</span></div><div class="line"><span class="preprocessor"># sampleCols=12</span></div><div class="line"><span class="preprocessor"># samples=192</span></div><div class="line"><span class="preprocessor"># format=&#39;${LON} ${LAT} ${AMVU} ${AMVV} ${QIND}&#39;</span></div><div class="line">23.1886 61.9644 -8.6854 -0.715033 0.848</div><div class="line">23.2634 62.0944 -9.64544 1.89509 0.244</div><div class="line">23.3389 62.2242 -9.01541 2.89513 0.204</div><div class="line">23.415 62.3541 -7.89536 9.53544 0.152</div><div class="line">23.4917 62.4839 -4.13519 4.48521 0.852</div><div class="line">...</div><div class="line">    ...</div><div class="line">        ...</div><div class="line">22.8894 62.0944 -10.0455 -1.16505 0.636</div><div class="line">22.8139 62.2242 -8.26538 -1.67508 0.216</div><div class="line">22.7378 62.3541 -8.47539 3.73517 0.688</div><div class="line">22.6611 62.4839 -6.04528 -0.365017 0.796</div><div class="line">22.5836 62.6136 -4.51521 -2.45511 0.32</div></div><!-- fragment --><p>Typically, user wants to obtain a Cartesian array, obtained with <code>&ndash;cCreate</code>, abbreviated <code>-c</code> . That operation has to be performed separately for <em>u</em> and <em>v</em> components, and using <code>&ndash;append</code> command to prevent overwriting: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-widespread.h5 --pDopplerInversion 2500,90 --append data -Q AMVU -c -Q AMVV -c  -o amv-cart.h5</div></div><!-- fragment --><p> The resulting motion fields will be in the last available dataset group, here <code>dataset1</code> . This behaviour can be changed with <code>&ndash;append</code> <code>dataset</code> which puts <code>AMVU</code> and <code>AMVV</code> in separate groups.</p>
<p>Similarly, cartesian sampling is done basically by changing extension <code></code>.h5 to <code></code>.dat </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-widespread.h5 --pDopplerInversion 2500,90 --append data -Q AMVU -c -Q AMVV -c --sample 30,30,skipVoid=1  --format <span class="stringliteral">&#39;${i} ${j2} ${AMVU} ${AMVV} ${QIND}&#39;</span> -o amv-cart.dat</div></div><!-- fragment --><p> producing:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># proj=&#39; +proj=aeqd +lon_0=23.0764 +lat_0=61.7673 +ellps=WGS84&#39;</span></div><div class="line"><span class="preprocessor"># BBOX=&#39;18.6913,59.4489 28.1476,63.9227&#39;</span></div><div class="line"><span class="preprocessor"># XRANGE=&#39;18.6913:28.1476&#39;</span></div><div class="line"><span class="preprocessor"># YRANGE=&#39;59.4489:63.9227&#39;</span></div><div class="line"><span class="preprocessor"># size=&#39;500x500&#39;</span></div><div class="line"><span class="preprocessor"># iStep=30</span></div><div class="line"><span class="preprocessor"># jStep=30</span></div><div class="line"><span class="preprocessor"># sampleRows=16</span></div><div class="line"><span class="preprocessor"># sampleCols=16</span></div><div class="line"><span class="preprocessor"># samples=256</span></div><div class="line"><span class="preprocessor"># format=&#39;${i} ${j2} ${AMVU} ${AMVV} ${QIND}&#39;</span></div><div class="line">285 424 -18.5771 -39.9209 0.008</div><div class="line">315 424 0.395257 100 0.008</div><div class="line">405 424 0.395257 3.55731 0.008</div><div class="line">315 394 35.1779 53.3597 0.008</div><div class="line">345 394 11.4625 16.2055 0.008</div><div class="line">...</div><div class="line">    ...</div><div class="line">        ...</div><div class="line">315 64 -29.6443 31.2253 0.008</div><div class="line">345 64 -10.6719 16.996 0.008</div><div class="line">375 64 -0.395257 19.3676 0.008</div><div class="line">135 34 90.5138 -30.4348 0.008</div><div class="line">165 34 -20.1581 21.7391 0.008</div></div><!-- fragment --><p>Accompanied utility script <code>draw-vectors.sh</code> creates plots of vector fields using <code>gnuplot</code> utility. The original data can be in text (<code></code>.dat) or HDF5 (<code></code>.h5) format. Optional background images can be applied. For example:</p>
<div class="fragment"><div class="line">BACKGROUND=background-dark.png OUTFILE=doppler-field.png ./draw-vectors.sh amv-cart.h5</div></div><!-- fragment --><div class="image">
<img src="doppler-field-panel.png" alt="doppler-field-panel.png"/>
<div class="caption">
Vector field derived by Doppler dealiasing.</div></div>
 <h2><a class="anchor" id="dopplerdealias"></a>
Dealiasing Doppler data</h2>
<p>As shown above, <b>Rack</b> produces wind fields (u,v) directly, but also de-aliased Doppler fields can be computed. This is obtained by re-projecting the approximated (u,v) data back to radar beams and matching the result with the original aliased data. This approach cancels the smoothing effect apparent in the approximated (u,v) field. Dealiasing is done by setting <code>nyquist</code> parameter to a desired virtual maximum speed, say 50m/s:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> amv-polar.h5 --pDopplerReproject 50 -Q VRAD -c --palette <span class="keywordflow">default</span> -o pDopplerDeAlias.png</div></div><!-- fragment --><div class="image">
<img src="pDopplerDeAlias-VRAD-panel.png" alt="pDopplerDeAlias-VRAD-panel.png"/>
<div class="caption">
De-aliased Doppler field.</div></div>
 <p>Alternatively, one may skip matching of the original and derived velocities with <code>matchAliased=0</code> , resulting in smoother images.</p>
<div class="image">
<img src="pDopplerDeAlias-VRAD-UNMATCHED-panel.png" alt="pDopplerDeAlias-VRAD-UNMATCHED-panel.png"/>
<div class="caption">
De-aliased Doppler field, without velocity matching.</div></div>
 <h2><a class="anchor" id="motiondetection"></a>
Detecting motion fields</h2>
<p><b>Rack</b> provides commands for extracting atmospheric motion vectors (AMV's). There are two approaches:</p><ol type="1">
<li>Deriving Doppler wind field in measurement volumes</li>
<li>Deriving motion field of apparent intensity changes in subsequent Cartesian images</li>
</ol>
<p>Both approaches are based on least-squares fitting applying matrix inversion.</p>
<h3><a class="anchor" id="oflow"></a>
Motion field apparent in subsequent images</h3>
<p>The technique is called <em>optical</em> <em>flow</em>, and is based on computing spatial and temporal differentials. Further, the implementation in <b>Rack</b> applies <em>sliding</em> <em>window</em> techniques which makes the approach computationally quick even with windows of size 75x75, for example.</p>
<p>The command, <code>&ndash;cOpticalFlow</code> , takes several parameters. The first two define the size of the sliding window.</p>
<div class="fragment"><div class="line">--cOpticalFlow  &lt;width&gt;,&lt;height&gt;,&lt;resize&gt;,&lt;threshold&gt;,&lt;spread&gt;,&lt;smooth&gt;</div><div class="line">  Optical flow computed based on differential accumulation layers.</div><div class="line">    width=1 </div><div class="line">    height=1 </div><div class="line">    resize=0 [0.0..1.0|pix]</div><div class="line">    threshold=NaN [value]</div><div class="line">    spread=<span class="keyword">false</span> [0|1]</div><div class="line">    smooth=<span class="keyword">false</span> [0|1]</div></div><!-- fragment --><p> The third parameter is an optional threshold, for example 0 (dBZ) in case of reflectivity data. Thresholding may be needed in order to filter apparent echo area edges caused radar geometry and sensitivity. Smoothing (1=true) is always recommended especially with radar images that have large areas of empty data ie. "undetected" echoes. Alternatively, radar data can be smoothed by some separate process or previous commands, say <code>&ndash;iAverage</code> or <code>&ndash;iGaussianAverage</code>.</p>
<p>The input should contain two Cartesian datasets, for example composites. An optimal time difference between the files is typically 15 or 30 minutes. Such file can be generated for example with </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> --append dataset composite-1130.h5 composite-1200.h5 -o composite-pair.h5</div></div><!-- fragment --><p>The actual processing is done as follows: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> composite-pair.h5 --cOpticalFlow 25,25,resize=250,threshold=0,smooth=1 -o motion.h5</div></div><!-- fragment --><p>The resulting file contains horizontal motion vector (<em>u</em>, <em>v</em>) stored in quantities <code>AMVU</code> and <code>AMVV</code> . In addition, a quality field (with <code>QIND</code> ) is provided. In addition, if <code>&ndash;store</code> intermediate=1 is set, then the following fields are stored:</p><ol type="1">
<li>Original two intensity fields (typically DBZH or RATE)</li>
<li>Smoothed fields (for example DBZH_smooth)</li>
<li>Derivatives - horz and vertical gradients, and time differential (for example DBZH_x, DBZH_y, DBZH_t)</li>
</ol>
<p>Note that the above commands can be combined to a single command line, avoiding creation of intermediate file (<code>composite-pair.h5</code> ).</p>
<p>As with Doppler motion, script <code>draw-vectors.sh</code> can be used for visualizing the result: </p><div class="fragment"><div class="line">OUTFILE=motion.png LINEWIDTH=2 TRANSP=0 ./draw-vectors.sh motion.h5</div></div><!-- fragment --><div class="image">
<img src="motion-0.png" alt="motion-0.png"/>
<div class="caption">
Motion vectors extracted with optical flow.</div></div>
<h2><a class="anchor" id="motion-spread"></a>
Spreading motion fields</h2>
<p>Both methods described above produce an incomplete motion field: Doppler dealiasing provides realiable vectors inside wide-spread precipitation whereas optical flow based motion analysis works best with visual details like edges and specks. <b>Rack</b> provides some methods for spreading the vector fields, with optional support of quality information. The methods are essentially image operators described in <a class="el" href="imagespage.html">Working with images</a>.</p>
<p>The spreading methods for two dimensional motion vectors are illustrated using an artificial image of "clouds" shown below. In vectors, high, intermediate, and low quality are illustrated in green, blue and pink colour, respectively. Utility script <code>draw-vectors.sh</code> and GnuPlot have been used in creating the visualisations below.</p>
<div class="image">
<img src="shapes1-motion-panel.png" alt="shapes1-motion-panel.png"/>
<div class="caption">
Artificial sparse vector field (left) and its quality field (right).</div></div>
<h3><a class="anchor" id="motion-smooth"></a>
Smoothing operators</h3>
<p>An straighforward way to spread scalar or vector data is to apply a <em>smoothing</em> <em>window</em> on data. In <b>Rack</b>, fast and simple smoothing is carried out using rectangular averaging window:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> motion.h5 --iAverage 200,200  -o motion-Average.h5</div></div><!-- fragment --> <div class="image">
<img src="spread-Average-panel.png" alt="spread-Average-panel.png"/>
<div class="caption">
Vector field spread with <code>--iAverage</code>, window size 200 x 200.</div></div>
<p>As a computational speed-up, the rectangular averaging window of size <img class="formulaInl" alt="$ W\times H $" src="form_50.png"/> is internally performed by <img class="formulaInl" alt="$ W\times 1 $" src="form_51.png"/> followed by <img class="formulaInl" alt="$ 1\times H $" src="form_52.png"/> window averaging; the narrow windows themselves are updated (accumulated) continuously, as a "pipeline", resulting in a very fast operation. As a disadvantage, rectangular patterns may also appear in the resulting images.</p>
<p>Two-dimensional Gaussian bell function produces smooth fields. Also that operator can be a separated to two consecutive one-dimensional run of <img class="formulaInl" alt="$ W\times 1 $" src="form_51.png"/> and <img class="formulaInl" alt="$ 1\times H $" src="form_52.png"/> windows, yet without pipelining. The bell curve is principally continuous and infinite, but practically truncated to size slightly larger than those of respective rectangular averaging windows.</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> motion.h5 --iGaussianAverage 400,400  -o motion-GaussianAverage.h5</div></div><!-- fragment --> <div class="image">
<img src="spread-GaussianAverage-panel.png" alt="spread-GaussianAverage-panel.png"/>
<div class="caption">
Vector field spread with <code>--iGaussianAverage</code>, window size 400 x 400.</div></div>
<p>Sometimes it is desired that opposite vector components do not cancel each other but the magnitudes be preserved like in a flow a fluid or particles. Using <code>&ndash;iFlowAverage</code> produces such vectors, pointing to directions of conventionally averaged vectors. </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> motion.h5 --iFlowAverage 200,200 -o motion-FlowAverage.h5</div></div><!-- fragment --> <div class="image">
<img src="spread-FlowAverage-panel.png" alt="spread-FlowAverage-panel.png"/>
<div class="caption">
Vector field spread with <code>--iFlowAverage</code>, window size 200 x 200.</div></div>
<p>The shape of this window operator is rectangular, and basically cannot be accelerated ie. separated to two operations with narrow windows. Technically, such processing can be performed by issuing the commands explicitly, producing an approximation of the true rectangular window operation: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> motion.h5 --iFlowAverage 200,1  --iFlowAverage 1,200 -o motion-FlowAverageApprox.h5</div></div><!-- fragment --><p>The problem with all the averaging operators is that they also blur areas of high-quality vectors. As a solution, the vectors of low quality in the resulting image should be overridden with vectors of higher quality of the original image. This kind of combination can be produced repeatedly using <code>&ndash;iBlender</code> which employs a desired averaging operator (above) with a maximum or mixing operator with the original image:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> motion.h5 --iBlender 200,200 -o  motion-Blender.h5</div></div><!-- fragment --> <div class="image">
<img src="spread-Blender-panel.png" alt="spread-Blender-panel.png"/>
<div class="caption">
Vector field spread with <code>--iBlender</code>, window size 200 x 200, applying simple averaging and maximum-quality combination.</div></div>
<h3><a class="anchor" id="motion-dist"></a>
Distance transform based operators</h3>
<p>An alternative way to spead vector fields is to apply distance transform based methods: data values are propagated in all the directions such that the underlying quality field is decreased as a function of distance. Propagation continues in low-quality areas until higher quality values are encountered. This method is very fast, but as a disadvantage the resulting vector fields contain segments of constant values as no averaging is involved. The basic version is applies linear model ie. constant steps in decreasing the underlying quality field. If the data has no quality data, it can be created with <code>&ndash;createDefaultQuality</code> .</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> motion.h5 --iDistanceTransformFill 200,200  -o motion-DistanceTransformFill.h5</div></div><!-- fragment --> <div class="image">
<img src="spread-DistanceTransformFill-panel.png" alt="spread-DistanceTransformFill-panel.png"/>
<div class="caption">
Vector field spread with <code>--iDistanceTransformFill</code>, window size 200 x 200.</div></div>
<p>When using distance transform approach, an area of high quality may override an area of lower quality if the areas are close enough like in the upper right corner of the sample image (the motion field of the pentagon overrides that of the rectangle). When using an exponential model, the resulting quality field has steeply decaying values - that however continue to infinity, in the limits of storage type precision.</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> motion.h5 --iDistanceTransformFillExp 200,200 -o  motion-DistanceTransformFillExp.h5</div></div><!-- fragment --> <div class="image">
<img src="spread-DistanceTransformFillExp-panel.png" alt="spread-DistanceTransformFillExp-panel.png"/>
<div class="caption">
Vector field spread with <code>--iDistanceTransformFillExp</code>, window size 200 x 200.</div></div>
<p>The linear and exponential approaches have same the computional complexity.</p>
<h2><a class="anchor" id="motion-composites"></a>
Composites of motion fields</h2>
<p>As explained on <a class="el" href="compositespage.html">Cartesian conversions and composites</a> for intensity data, it is possible to composites of motion fields generated above. However, this is has to be done separately for each parameter, in this case horizontal wind components <code>AMVU</code> and <code>AMVV</code> .</p>
<div align="center">
<img src="dot_inline_dotgraph_6.png" alt="dot_inline_dotgraph_6.png" border="0" usemap="#dot_inline_dotgraph_6.map"/>
<map name="dot_inline_dotgraph_6.map" id="dot_inline_dotgraph_6.map"><area shape="rect" id="node4" href="compositespage.html" title="Composite | &lt;i&gt; AMVU" alt="" coords="168,31,249,83"/>
<area shape="rect" id="node5" href="compositespage.html" title="Composite | &lt;i&gt; AMVV" alt="" coords="168,107,249,159"/>
</map>
</div>
<p>For example, assuming that &ndash;c &lt;files&gt; are a set of motion files to be composites: </p><div class="fragment"><div class="line">Q=AMVU; <a class="code" href="namespacerack.html">rack</a> --cMethod MAXW --script <span class="stringliteral">&quot;-Q $Q --cAdd&quot;</span> &lt;files&gt; --cExtract dw -o motion-$Q.h5</div><div class="line">Q=AMVV; <a class="code" href="namespacerack.html">rack</a> --cMethod MAXW --script <span class="stringliteral">&quot;-Q $Q --cAdd&quot;</span> &lt;files&gt; --cExtract dw -o motion-$Q.h5</div><div class="line"><a class="code" href="namespacerack.html">rack</a> --append data motion-AMV?.h5 -o &lt;motion-composite&gt;</div></div><!-- fragment --><p> Note that the input files can be the same in the above lines, if they contain both the quantities. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
