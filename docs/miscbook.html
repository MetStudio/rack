<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Miscellaneous commands and scripts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="rack.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rack-logo-110x55.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Miscellaneous commands and scripts </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>This section explains general commands and useful hints in using <b>Rack</b>.</p>
<h1><a class="anchor" id="scripts"></a>
Scripts</h1>
<p>If a fixed set of commands &ndash; a script &ndash; is needed for each input, one may define it with <code>&ndash;script</code> . The script is then executed automatically for each input:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> --script <span class="stringliteral">&#39;&lt;commands&gt;&#39;</span>  &lt;file&gt; &lt;file2&gt; &lt;file3&gt; ...</div></div><!-- fragment --><p>The functionality is handy for example in running anomaly detection and product generation for a set of files. Defining a script also turns on <em>variable expansion</em> (see also examples below in <a class="el" href="miscbook.html#templates">Metadata output using text templates</a> ). The automatic execution can be reset with <code>&ndash;autoExec 0</code>, and the script is executed only upon issuing <code>&ndash;exec </code>.</p>
<p>Instead of the command line, one may also execute commands stored in a file as follows:</p>
<div class="fragment"><div class="line">rack &lt;file&gt;  --executeFile &lt;cmdFile&gt;   </div></div><!-- fragment --><p>Remember that plain filenames are implicit <code>&ndash;inputFile &lt;file&gt;</code> commands; hence the file can also be a list of input files. Using such a file together with <code>&ndash;script</code> yields compact command lines especially in compositing.</p>
<h1><a class="anchor" id="sampling"></a>
Sampling grid data</h1>
<p>The input volume as well as the generated polar or Cartesian products can be sampled, producing a text file. The sampling is performed automatically if output file has the extension '.dat'. For example: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 -o samples.dat</div></div><!-- fragment --><p>The result: </p><div class="fragment"><div class="line"><span class="preprocessor">## input properties </span></div><div class="line"><span class="preprocessor"># bbox=[26.319,67.9454,26.3189,67.9454]</span></div><div class="line"><span class="preprocessor"># height=360</span></div><div class="line"><span class="preprocessor"># lat=64.7749</span></div><div class="line"><span class="preprocessor"># lon=26.3189</span></div><div class="line"><span class="preprocessor"># width=500</span></div><div class="line"><span class="preprocessor">## sampling parameters </span></div><div class="line"><span class="preprocessor"># commentChar=&quot;#&quot;</span></div><div class="line"><span class="preprocessor"># i=[-1:-1]</span></div><div class="line"><span class="preprocessor"># iStep=10</span></div><div class="line"><span class="preprocessor"># j=[-1:-1]</span></div><div class="line"><span class="preprocessor"># jStep=0</span></div><div class="line"><span class="preprocessor"># skipVoid=false</span></div><div class="line"><span class="preprocessor"># format=&#39;${i},${j},${LON},${LAT},${X},${Y},${RANGE},${AZM},${DBZH},${DBZHC},${DBZX},${HCLASS},${KDP},${PHIDP},${RHOHV},${SQI},${TH},${TX},${VRAD},${WRAD},${ZDR},${ZDRC}&#39;</span></div><div class="line"><span class="preprocessor">## resulting geometry </span></div><div class="line"><span class="preprocessor"># rows=50</span></div><div class="line"><span class="preprocessor"># rols=36</span></div><div class="line"><span class="preprocessor"># samples=1800</span></div><div class="line">5,5,26.3239,64.7995,239.678,2739.54,2750,5,0,0,0,0,0,0,0,0.212275,37.71,37.18,0,0,0,0 #<span class="keywordtype">void</span> data</div><div class="line">15,5,26.3331,64.8441,675.457,7720.51,7750,5,0,0,0,0,0,0,0,0.162971,38.1,36.56,0,0,0,0 #<span class="keywordtype">void</span> data</div><div class="line">25,5,26.3424,64.8888,1111.24,12701.5,12750,5,11.32,11.32,11.3,2,0,36.5526,0.994507,0.826271,17.91,17.45,-6.51,1.39,0.04,0.04</div><div class="line">65,5,26.3796,65.0675,2854.35,32625.4,32750,5,-6.71,-6.71,-6.66,1,0.01,32.982,0.953184,0.816047,-6.05,-5.71,-6.83,0.81,-0.48,-0.48</div><div class="line">75,5,26.3889,65.1122,3290.13,37606.3,37750,5,15.02,15.87,14.44,2,0.03,33.0369,0.98883,0.897899,15.12,14.48,6.95,0.95,1.11,1.28</div><div class="line">85,5,26.3983,65.1569,3725.91,42587.3,42750,5,-12.46,45.5,-14.59,1,-0.03,20.9076,0.64775,0.067157,-12.12,-13.32,6.91,0.01,-0.28,9.75</div><div class="line">95,5,26.4078,65.2015,4161.69,47568.3,47750,5,-6.01,52.06,-7.88,1,0.01,56.1089,0.841545,0.510628,-6.12,-7.9,-2.71,0.01,1.96,12</div><div class="line">...</div><div class="line">    ...</div><div class="line">        ...</div><div class="line">455,355,25.8675,66.809,-19849.7,226883,227750,355,6.92,6.92,5.55,4,-0.08,50.6265,0.783865,0.356263,6.75,5.52,-2.21,0.01,0.4,0.4</div><div class="line">465,355,25.8567,66.8536,-20285.5,231864,232750,355,4.23,4.23,3.73,4,-0.06,41.9086,0.931653,0.353257,4.06,3.78,-1.75,1.92,0.04,0.04</div><div class="line">475,355,25.8459,66.8983,-20721.3,236845,237750,355,4.67,4.67,4.22,1,0.16,23.44,0.819084,0.304259,4.97,4.78,-1.31,0.01,-1.25,-1.25</div><div class="line">485,355,25.8351,66.9429,-21157.1,241826,242750,355,6.03,6.03,5.17,4,0.32,54.4774,0.835854,0.420826,5.92,5.22,-2.57,1.7,-0.1,-0.1</div><div class="line">495,355,25.8242,66.9875,-21592.8,246807,247750,355,7.15,7.15,5.34,4,0.42,48.4182,0.771184,0.307814,7.01,5.43,-1.78,1.71,0.91,0.91</div></div><!-- fragment --><p>The default sampling step is 10 in both horizontal and vertical direction, and all the quantities are sampled. One may apply <code>&ndash;select</code> command to get desired subset of quantities. Further, <code>&ndash;format</code> modifies output layout; variables marked like <code>${NAME}</code> are converted to actual values in output:</p><ul>
<li><em>i</em> , <em>j</em> and <em>j2:</em> image coordinates, from top-left corner (bin and azimuth index in polar sampling);</li>
<li><em>j2:</em> inverted vertical image coordinate ie. from bottom-left corner</li>
<li><em>LON</em> and <em>LAT</em> : geographical coordinates, in degreees</li>
<li><em>X</em> and <em>Y</em> : map coordinates, in metres</li>
<li><em>AZM</em> and <em>RANGE:</em> polar coordinates (applicable in polar sampling only)</li>
<li>the quantities, eg. <code>DBZH</code> , <code>VRAD</code> , and so one, including quality quantities like <code>QIND</code>. The default format consists of all the applicable coordinates and quantities separated by space. Values can be negated by putting a minus sign inside the curly braces of a format string.</li>
</ul>
<p>Sampling steps, start, and end can be changed with <code>&ndash;sample</code> command. One may also skip lines containing <code>undetect</code> or <code>nodata</code> samples. If a comment char is defined some metadata, including applied format, appears as comments in the start of the output.</p>
<div class="fragment"><div class="line">--sample  &lt;iStep&gt;,&lt;jStep&gt;,&lt;i&gt;,&lt;j&gt;,&lt;commentChar&gt;,&lt;skipVoid&gt;  (Section: general)</div><div class="line">  Extract samples. See --format.</div><div class="line">    iStep=10 [horz coord step]</div><div class="line">    jStep=0 [vert coord step]</div><div class="line">    i=-1:-1 [horz index or range]</div><div class="line">    j=-1:-1 [vert index or range]</div><div class="line">    commentChar=# [comment prefix (char or bytevalue)]</div><div class="line">    skipVoid=false [skip lines with invalid/missing values]</div></div><!-- fragment --><p>Example of a formatted sampling: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --select quantity=DBZH --sample 10,30,i=50:200,j=0:50 --format <span class="stringliteral">&#39;${i},${j2} (${LON},${LAT}) ${DBZH}&#39;</span> -o samples-formatted.dat</div></div><!-- fragment --><p>The result: </p><div class="fragment"><div class="line"><span class="preprocessor">## input properties </span></div><div class="line"><span class="preprocessor"># bbox=[26.319,67.9454,26.3189,67.9454]</span></div><div class="line"><span class="preprocessor"># height=360</span></div><div class="line"><span class="preprocessor"># lat=64.7749</span></div><div class="line"><span class="preprocessor"># lon=26.3189</span></div><div class="line"><span class="preprocessor"># width=500</span></div><div class="line"><span class="preprocessor">## sampling parameters </span></div><div class="line"><span class="preprocessor"># commentChar=&quot;#&quot;</span></div><div class="line"><span class="preprocessor"># i=[50:200]</span></div><div class="line"><span class="preprocessor"># iStep=10</span></div><div class="line"><span class="preprocessor"># j=[0:50]</span></div><div class="line"><span class="preprocessor"># jStep=30</span></div><div class="line"><span class="preprocessor"># skipVoid=false</span></div><div class="line"><span class="preprocessor"># format=&#39;${i},${j2} (${LON},${LAT}) ${DBZH}&#39;</span></div><div class="line"><span class="preprocessor">## resulting geometry </span></div><div class="line"><span class="preprocessor"># rows=50</span></div><div class="line"><span class="preprocessor"># rols=12</span></div><div class="line"><span class="preprocessor"># samples=600</span></div><div class="line">60,${j2} (26.3189,65.0462) 0 #<span class="keywordtype">void</span> data</div><div class="line">50,${j2} (26.3189,65.0014) -13.99</div><div class="line">90,${j2} (26.3189,65.1808) -10.79</div><div class="line">60,${j2} (26.6396,65.0095) -11.71</div><div class="line">70,${j2} (26.6932,65.0482) -5.82</div><div class="line">80,${j2} (26.7469,65.0869) -10.65</div><div class="line">...</div><div class="line">    ...</div><div class="line">        ...</div><div class="line">160,${j2} (27.1823,65.3958) 0 #<span class="keywordtype">void</span> data</div><div class="line">170,${j2} (27.2374,65.4343) 0 #<span class="keywordtype">void</span> data</div><div class="line">180,${j2} (27.2927,65.4728) 6.74</div><div class="line">190,${j2} (27.3482,65.5113) 19.96</div><div class="line">200,${j2} (27.4038,65.5497) 0 #<span class="keywordtype">void</span> data</div></div><!-- fragment --><p>Likewise, one can sample Cartesian data. Example: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --select quantity=DBZH --cSize 500,500 -c --sample 50,50  -o samples-cart.dat</div></div><!-- fragment --><p>The result: </p><div class="fragment"><div class="line"><span class="preprocessor">## input properties </span></div><div class="line"><span class="preprocessor"># bbox=[21.4734,62.4469,32.0369,66.9151]</span></div><div class="line"><span class="preprocessor"># height=500</span></div><div class="line"><span class="preprocessor"># proj=&quot; +proj=aeqd +lon_0=26.3189 +lat_0=64.7749 +ellps=WGS84&quot;</span></div><div class="line"><span class="preprocessor"># width=500</span></div><div class="line"><span class="preprocessor">## sampling parameters </span></div><div class="line"><span class="preprocessor"># commentChar=&quot;#&quot;</span></div><div class="line"><span class="preprocessor"># i=[-1:-1]</span></div><div class="line"><span class="preprocessor"># iStep=50</span></div><div class="line"><span class="preprocessor"># j=[-1:-1]</span></div><div class="line"><span class="preprocessor"># jStep=50</span></div><div class="line"><span class="preprocessor"># skipVoid=false</span></div><div class="line"><span class="preprocessor"># format=&#39;${i},${j},${LON},${LAT},${X},${Y},${j2},${DBZH},${QIND}&#39;</span></div><div class="line"><span class="preprocessor">## resulting geometry </span></div><div class="line"><span class="preprocessor"># rows=10</span></div><div class="line"><span class="preprocessor"># rols=10</span></div><div class="line"><span class="preprocessor"># samples=100</span></div><div class="line">25,25,26.3194,64.7755,22.0121,66.6872,474,65535,0 #<span class="keywordtype">void</span> data</div><div class="line">75,25,26.3194,64.7755,23.0685,66.6872,474,65535,0 #<span class="keywordtype">void</span> data</div><div class="line">125,25,26.3194,64.7755,24.1248,66.6872,474,65535,0 #<span class="keywordtype">void</span> data</div><div class="line">225,25,26.3195,64.7755,26.2375,66.6872,474,8.25,0.5</div><div class="line">275,25,26.3195,64.7755,27.2939,66.6872,474,5.9,0.5</div><div class="line">225,75,26.3195,64.7755,26.2375,66.2404,424,13.63,0.5</div><div class="line">175,125,26.3194,64.7755,25.1812,65.7935,374,9.42,0.5</div><div class="line">225,125,26.3195,64.7755,26.2375,65.7935,374,6.45,0.5</div><div class="line">...</div><div class="line">    ...</div><div class="line">        ...</div><div class="line">275,475,26.3195,64.7755,27.2939,62.6658,24,0,0.5 #<span class="keywordtype">void</span> data</div><div class="line">325,475,26.3195,64.7755,28.3502,62.6658,24,0,0.5 #<span class="keywordtype">void</span> data</div><div class="line">375,475,26.3195,64.7755,29.4066,62.6658,24,65535,0 #<span class="keywordtype">void</span> data</div><div class="line">425,475,26.3195,64.7755,30.4629,62.6658,24,65535,0 #<span class="keywordtype">void</span> data</div><div class="line">475,475,26.3196,64.7755,31.5193,62.6658,24,65535,0 #<span class="keywordtype">void</span> data</div></div><!-- fragment --><p>Note that <code>&ndash;cCreate</code> maps a single quantity to Cartesian coordinates; the quantity can be changed with <code>&ndash;select</code> .</p>
<h1><a class="anchor" id="templates"></a>
Metadata output using text templates</h1>
<p>There is often need to produce metadata text for:</p><ul>
<li>Text files completing data formats not supporting metadata</li>
<li>Log entries</li>
<li>HTML files applied in monitoring product generation</li>
<li>Graphical layouts (eg. SVG)</li>
<li>Geographic definition files (eg. KML) for adding radar products to GIS applications</li>
</ul>
<p>One can easily export metadata of current HDF5 structure (latest volume read or product generated). The output is a text file in which variables <code>${variable}</code> have been expanded to their current values.</p>
<p>The text template can be defined briefly on command line by <code>&ndash;format</code> or by reading a file with <code>&ndash;formatFile</code> .</p>
<p>For example, from a Cartesian product one may extract the projection and a bounding box with the following command: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 -c  --format <span class="stringliteral">&#39;BBOX=${where:LL_lon},${where:LL_lat},${where:UR_lon},${where:UR_lat}\n&#39;</span> --formatOut formatOut.txt </div></div><!-- fragment --><p>The result: </p><div class="fragment"><div class="line">BBOX=21.4734,62.4469,32.0369,66.9151</div></div><!-- fragment --><p>The applicable variables are those the ODIM variables (what:product, where:lat, ...). In addition, <code>what:source</code> fields (<code>NOD</code>, <code>WMO</code> , <code>RAD</code> , <code>PLC</code> , <code>CMT</code> ) are searched for and expanded to convenience variables (<code>${NOD}</code>, etc...). The list of current variables can be examined with <code>&ndash;status</code> command.</p>
<p>For example, assume template file <code>radar-conf.tpl</code> with the following contents:</p>
<div class="fragment"><div class="line"># Metadata for radar &#39;${NOD}&#39;</div><div class="line"></div><div class="line">SOURCE=&quot;${what:source}&quot;</div><div class="line">NOD=&quot;${NOD}&quot;</div><div class="line">WMO=&quot;${WMO}&quot;</div><div class="line">PLC=&quot;${PLC}&quot;</div><div class="line">LAT=&quot;${where:lat}&quot;</div><div class="line">LON=&quot;${where:lon}&quot;</div><div class="line">HEIGHT=&quot;${where:height}&quot;</div><div class="line">PROJDEF=&quot;${where:projdef}&quot;</div><div class="line">BBOX=&quot;${where:LL_lon},${where:LL_lat},${where:UR_lon},${where:UR_lat}&quot;</div></div><!-- fragment --><p>Then, </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 -c --formatFile radar-conf.tpl --formatOut out.cnf  </div></div><!-- fragment --><p> produces code which can be used by applications supporting <b>Proj4</b> projection syntax. The result:</p>
<div class="fragment"><div class="line"># Metadata for radar &#39;fiuta&#39;</div><div class="line"></div><div class="line">SOURCE=&quot;WMO:02870,RAD:FI47,PLC:Utajärvi,NOD:fiuta&quot;</div><div class="line">NOD=&quot;fiuta&quot;</div><div class="line">WMO=&quot;02870&quot;</div><div class="line">PLC=&quot;Utajärvi&quot;</div><div class="line">LAT=&quot;64.7749&quot;</div><div class="line">LON=&quot;26.3189&quot;</div><div class="line">HEIGHT=&quot;118&quot;</div><div class="line">PROJDEF=&quot; +proj=aeqd +lon_0=26.3189 +lat_0=64.7749 +ellps=WGS84&quot;</div><div class="line">BBOX=&quot;21.4734,62.4469,32.0369,66.9151&quot;</div></div><!-- fragment --><p>Further, using <code>&ndash;script</code> one can quickly create similar conf files with a single command: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> --formatFile radar-conf.tpl --script <span class="stringliteral">&#39;--cReset -c --formatOut site-${NOD}.cnf&#39;</span> &lt;volumes.h5&gt;</div></div><!-- fragment --><p> Note that <code>&ndash;script</code> implicitly sets <code>&ndash;expandVariables</code> .</p>
<h1><a class="anchor" id="checkscope"></a>
Does a radar overlap with a given geographical scope?</h1>
<p>Consider generating a composite on a geographical scope defined by a projection and a bounding box. If the area is small with respect to the surrounding radar network, one should not read all the possible radar files at hand, even though <code>Rack</code> will automatically reject volume data which is out of scope. This is especially critical if radar data are archived, needing time-consuming retrieval, uncompressing and format conversion. Hence, one needs a means of advance checking if a radar should be included or not in the composite.</p>
<p>In <b>Rack</b>, commands of type <code>&ndash;/xxx/xxx</code>:yyy=zzz are interpreted as ODIM metadata to be set in the current HDF5 object. <code>Rack</code> always contains one object, initially empty, for which the metadata can be set as well. As for with a true input volume, one can check the geographical scope of this "volume" using <code>&ndash;cBBoxTest</code> command as follows, for example:</p>
<div class="fragment"><div class="line">rack --verbose 0 \</div><div class="line">     --cProj &#39;+proj=stere +lon_0=25.0 +lat_0=60.000&#39; \</div><div class="line">     --cBBox &#39;20,58,30,63&#39; \</div><div class="line">     --/where:lon=26.32  \</div><div class="line">     --/where:lat=64.77  \</div><div class="line">     --/where:nbins=500  \</div><div class="line">     --/where:rscale=500 \</div><div class="line">     --cBBoxTest 1</div><div class="line"></div></div><!-- fragment --><p>The result can be checked from the return code, which is zero if the radar range overlaps with the composite domain, and non-zero otherwise.</p>
<p>Another way is to call <code>&ndash;formatOut</code> for each input volume, using <code>&ndash;format</code> that contains <code>${BBOX}</code> and other desired status variables. For example: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a>  --cProj <span class="stringliteral">&#39;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&#39;</span> --cBBox 20,60,30,70 \</div><div class="line">  --format <span class="stringliteral">&#39;${BBOX} ${CMT} ${what:source} ${inputFile} \n&#39;</span> \</div><div class="line">  --verbose 0  --script <span class="stringliteral">&#39;--cBBoxTest 1 --formatOut -&#39;</span> \</div><div class="line">  data/pvol_*</div></div><!-- fragment --><p>Instead of giving <code>nbins</code> and <code>rscale</code> , the range can be given using the non-standard <code>&ndash;where:range</code> directly (in metres, for example 250000).</p>
<p>This command could be called by a script which iterates through sample files, and the results are catenated in a file like </p><div class="fragment"><div class="line"><span class="preprocessor"># FMI radars</span></div><div class="line">fianj=27.1111,60.9036</div><div class="line">fiika=23.08,61.767</div><div class="line">fikor=21.6465,60.1284</div><div class="line">...</div></div><!-- fragment --><p>A further application could be in an operational compositing process, where another script iterates through these entries, testing locations with <code>&ndash;cBBoxTest</code> as shown above and including successful sites in the actual compositing script. A variable names, instead of output of <code>${what:source}</code> above, it is practical to use radar site codes in the form they appear in filenames.</p>
<h1><a class="anchor" id="quantityConf"></a>
Default encoding of quantities</h1>
<p>Measurement parameters of radars have a varying scale. For example, DBZH is typically between -32dBZ and 50dBZ whereas RHOHV ranges between 0.0 and 1.0. Further, different storage types can be used, and the resulting value range should be compatible with the encoding. In some cases, like in creating radar image composites, <b>Rack</b> can use predefined storage types and encoding. The following examples illustrate the usage</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> --quantityConf DBZH:S          # <span class="keywordflow">for</span> encoding dBZ, use <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> int, with <span class="keywordflow">default</span> scaling</div><div class="line"><a class="code" href="namespacerack.html">rack</a> --quantityConf DBZH:C,0.6,-30  # <span class="keywordflow">for</span> encoding dBZ, use <span class="keywordtype">unsigned</span> char, with gain=0.5 and offset=-32</div></div><!-- fragment --><p>The arguments can be named explicitly, as in the case of <code>&ndash;select</code> and <code>&ndash;encoding</code> . The encoding of a given quantity is displayed if the quantity is issued without type specifier character. A quantity can be also assigned <code>zero</code>, a "virtual" physical small value to be applied instead of <code>undetect</code> marker.</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> --quantityConf <span class="stringliteral">&#39;DBZH&#39;</span></div></div><!-- fragment --><p>yelding </p><div class="fragment"><div class="line">DBZH</div><div class="line">  *C,{<span class="stringliteral">&quot;what:type&quot;</span>:<span class="stringliteral">&quot;C&quot;</span>,<span class="stringliteral">&quot;what:gain&quot;</span>:0.5,<span class="stringliteral">&quot;what:offset&quot;</span>:-32,<span class="stringliteral">&quot;what:undetect&quot;</span>:0,<span class="stringliteral">&quot;what:nodata&quot;</span>:255} (min=-31.5)</div><div class="line">   S,{<span class="stringliteral">&quot;what:type&quot;</span>:<span class="stringliteral">&quot;S&quot;</span>,<span class="stringliteral">&quot;what:gain&quot;</span>:0.01,<span class="stringliteral">&quot;what:offset&quot;</span>:-327.68,<span class="stringliteral">&quot;what:undetect&quot;</span>:0,<span class="stringliteral">&quot;what:nodata&quot;</span>:65535} (min=-327.67)</div><div class="line">    <span class="keyword">virtual</span> zero=-32</div></div><!-- fragment --><p> where asterisk <code>*</code> marks the current default storage type and scaling.</p>
<p>The full list of predefined quantity encodings are listed with </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> --quantityConf <span class="stringliteral">&#39;&#39;</span></div></div><!-- fragment --><p> One may freely add encodings simply by setting them with <code>&ndash;quantityConf</code> </p>
<h1><a class="anchor" id="testdata"></a>
Creating test volumes</h1>
<p>The following script can be applied to create test volumes.</p>
<div class="fragment"><div class="line">#!/bin/bash</div><div class="line">#</div><div class="line"># Generates an artificial radar volume (chessboard data).</div><div class="line">#</div><div class="line"># Part of Rack distribution</div><div class="line">#</div><div class="line"># Markus.Peura@fmi.fi</div><div class="line"></div><div class="line">PATH=${PATH}&#39;:/fmi/dev/bin&#39;</div><div class="line"></div><div class="line">QUANTITY=${QUANTITY:-&#39;DBZH&#39;}</div><div class="line">OUTDIR=${OUTDIR:-&quot;.&quot;}</div><div class="line">OUTFILE=${OUTFILE:-&quot;testdata-$QUANTITY.h5&quot;}</div><div class="line"></div><div class="line">NBINS=${NBINS:-&#39;500&#39;}</div><div class="line">NRAYS=${NRAYS:-&#39;360&#39;}</div><div class="line">RSCALE=${RSCALE:-&#39;500&#39;}</div><div class="line"></div><div class="line">LON=${LON:-&#39;25.0&#39;}</div><div class="line">LAT=${LAT:-&#39;60.0&#39;}</div><div class="line"></div><div class="line"></div><div class="line">GAIN=${GAIN:-&#39;0.5&#39;}</div><div class="line">OFFSET=${OFFSET:-&#39;-32&#39;}</div><div class="line">UNDETECT=${UNDETECT:-&#39;0&#39;}</div><div class="line">NODATA=${NODATA:-&#39;255&#39;}</div><div class="line"></div><div class="line"># Base &quot;data&quot;: a 2x2 grid replicated over the image</div><div class="line">VALUES=${VALUES:-$(( RANDOM &amp; 127 )),$(( RANDOM &amp; 127 + 128 ))}</div><div class="line">VALUES=${VALUES/:/,}</div><div class="line">#VALUES=${VALUES:-&quot;64:192&quot;}</div><div class="line">VALUES=( ${VALUES/,/ } )</div><div class="line">DARK=${VALUES[0]} </div><div class="line">LIGHT=${VALUES[1]} </div><div class="line">#DARK=$((  RANDOM &amp; 127 ))</div><div class="line">#LIGHT=$(( RANDOM &amp; 127 + 128 ))</div><div class="line">DATA=${DATA:-&quot;$DARK,$LIGHT,$LIGHT,$DARK&quot;}</div><div class="line"></div><div class="line">BASENAME=${OUTFILE%.*}</div><div class="line">IMGFILE=${BASENAME}-raw.png</div><div class="line">TILEFILE=${BASENAME}-tile.png</div><div class="line">CMDFILE=${BASENAME}.sh</div><div class="line"></div><div class="line">#</div><div class="line">if [ &quot;$COORD&quot; == &#39;c&#39; ]; then</div><div class="line">    cart=&#39;-c&#39;</div><div class="line">else</div><div class="line">    cart=&#39;&#39;</div><div class="line">fi</div><div class="line"></div><div class="line"># PALETTE=default</div><div class="line">if [ &quot;$PALETTE&quot; == &#39;default&#39; ]; then</div><div class="line">    PALETTE=$QUANTITY</div><div class="line">fi</div><div class="line">palette=${PALETTE:+&quot;--palette palette/palette-$PALETTE.txt&quot;}</div><div class="line"></div><div class="line"></div><div class="line"># Step 1: create png image file</div><div class="line">echo $(( NBINS / 20 ))x$(( NRAYS / 20 ))</div><div class="line">echo &quot;P2 2 2 255  ${DATA//,/ }&quot; | convert pgm:- -filter Point -resize $(( NBINS / 5 ))x$(( NRAYS / 20 ))\! ${OUTDIR}/${TILEFILE}</div><div class="line"></div><div class="line">if [ ! -s &quot;${OUTDIR}/${TILEFILE}&quot; ]; then</div><div class="line">    echo &quot;502 Could not generate tile file: ${OUTDIR}/${TILEFILE}&quot; </div><div class="line">    exit 1</div><div class="line">fi</div><div class="line"></div><div class="line">if [ &quot;$FORMAT&quot; == &#39;sh&#39; ]; then</div><div class="line">   OUTFILE=${BASENAME}.h5</div><div class="line">fi</div><div class="line"></div><div class="line">   </div><div class="line"></div><div class="line">cat &gt; $OUTDIR/$CMDFILE &lt;&lt;EOF</div><div class="line"># Step 2: expand to a gridded png image</div><div class="line">convert -size ${NBINS}x${NRAYS} tile:$OUTDIR/${TILEFILE} -type GrayScale -depth 8 ${OUTDIR}/${IMGFILE}</div><div class="line"></div><div class="line"># Step 3: add ODIM variables, convert to HDF5</div><div class="line">rack ${OUTDIR}/${IMGFILE} \</div><div class="line">  --/what:object=PVOL \</div><div class="line">  --/where:lon=$LON \</div><div class="line">  --/where:lat=$LAT \</div><div class="line">  --/how:simulated=True \</div><div class="line">  --/dataset1/where:nbins=$NBINS \</div><div class="line">  --/dataset1/where:nrays=$NRAYS \</div><div class="line">  --/dataset1/where:rscale=$RSCALE \</div><div class="line">  --/dataset1/data1/what:quantity=$QUANTITY \</div><div class="line">  --/dataset1/data1/what:gain=$GAIN   \</div><div class="line">  --/dataset1/data1/what:offset=$OFFSET \</div><div class="line">  --completeODIM \</div><div class="line">  ${cart} ${palette} \</div><div class="line">  -o ${OUTDIR}/${OUTFILE}</div><div class="line"></div><div class="line">rm -v $OUTDIR/${IMGFILE} </div><div class="line">rm -v $OUTDIR/${TILEFILE}</div><div class="line">EOF</div><div class="line"></div><div class="line">if [ &quot;$FORMAT&quot; != &#39;sh&#39; ]; then</div><div class="line">   source $OUTDIR/$CMDFILE</div><div class="line">fi</div><div class="line"></div><div class="line"># That&#39;s it</div></div><!-- fragment --><div class="image">
<img src="test-sweep-both.png" alt="test-sweep-both.png"/>
<div class="caption">
Test data in its original polar coordinates and Cartesian projection.</div></div>
  </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
