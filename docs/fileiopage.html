<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>File input and output</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="rack.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rack-logo-110x55.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Sections</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">File input and output </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Rack</b> supports reading sweep and volume files in HDF5 format using OPERA information model (ODIM). In addition, supports reading and writing data as images and text files.</p>
<h1><a class="anchor" id="file_read_h5"></a>
Reading and writing HDF5 files</h1>
<p>Input files are given as plain arguments, that is, without the prefix "--". If several files are given, they will be internally combined to a single volume, adding datasets incrementally. Outputs are generated using <code>&ndash;outputFile</code> , abbreviated <code>-o</code>. Hence, combining sweep files to a volume is obtained simply with </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> sweep1.h5 sweep2.h5 sweep3.h5  -o volume-combined.h5 </div></div><!-- fragment --><p>In combining sweep data to volumes, <b>Rack</b> creates and updates one <code>/dataset&lt;i&gt;</code> group for each <em>elevation</em> <em>angle</em> . Further, <b>Rack</b> creates and updates one <code>/data&lt;i&gt;</code> group for each <em>quantity</em> ; new input overwrites existing data of the same quantity.</p>
<p>If quality information &ndash; stored under some <code>/quality</code>[i] group and marked with <code>what:quantity=QIND</code> &ndash; is read, the overall quality indices are updated automatically.</p>
 <div class="image">
<img src="volume-hdfview-small.png" alt="volume-hdfview-small.png"/>
<div class="caption">
A volume combined from three separate files (illustrated with HDFview).</div></div>
<h2><a class="anchor" id="file_quality"></a>
Reading and combining quality data</h2>
<p>In an operative environment, two parallel processes may perform quality control. <b>Rack</b> intelligently combines the resulting files using the following logic:</p>
<ul>
<li>The main quality field (<code>quantity=QIND</code> ) is updated, based on either target class field (<code>quantity=CLASS</code>) or (<code>quantity=&lt;class-name&gt;</code> ):<ol type="1">
<li>If overall classification (<code>quantity=CLASS</code>) is provided, <code>QIND</code> and <code>CLASS</code> will be updated directly from those.</li>
<li>If <code>CLASS</code> is not provided, <code>QIND</code> will be updated from the specific class probability (<code>quantity=&lt;class-name&gt;</code> ).</li>
</ol>
</li>
<li>Under the group containing <code>QIND</code> (typically <code>/quality1</code> ), <code>how:task_args</code> will be updated by the names of the added classes.</li>
</ul>
<p>In the following example, the quantities (detection classes) applied are those produced by <b>Rack</b> but could be thought as if they were produced by some other software, with same or similar names.</p>
<p>Consider two quality control processes, the first producing detection of <code>EMITTER</code> and <code>JAMMING</code> , stored in file <code>volume-det1.h5</code> , containing following data (among others):</p>
<div class="fragment"></div><!-- fragment --><p>Assume the other process detecting <code>SHIP</code> and <code>SPECKLE</code> stored in <code>volume-det2.h5</code> , respectively:</p>
<div class="fragment"><div class="line">dataset1/data1/what:quantity=TH [#3@1]</div><div class="line">dataset1/data2/quality1/what:quantity=QIND [#5@1]</div><div class="line">dataset1/data2/quality2/what:quantity=CLASS [#6@1]</div><div class="line">dataset1/data2/quality3/what:quantity=SHIPOP [#7@1]</div><div class="line">dataset1/data2/what:quantity=DBZH [#5@1]</div><div class="line">dataset1/data4/what:quantity=WRAD [#5@1]</div><div class="line">dataset1/quality1/what:quantity=QIND [#5@1]</div><div class="line">dataset1/quality2/what:quantity=CLASS [#6@1]</div><div class="line">dataset1/quality3/what:quantity=SPECKLEOP [#10@1]</div></div><!-- fragment --><p>These files can be combined simply with </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-det1.h5 volume-det2.h5  -o volume-det-combined.h5</div></div><!-- fragment --><p>The resulting file contains strcuture as follows: </p><div class="fragment"><div class="line">dataset1/data2/quality1/what:quantity=QIND [#5@1]</div><div class="line">dataset1/data2/quality2/what:quantity=CLASS [#6@1]</div><div class="line">dataset1/data2/quality3/what:quantity=EMITTEROP [#10@1]</div><div class="line">dataset1/data2/quality4/what:quantity=SHIPOP [#7@1]</div><div class="line">dataset1/data2/what:quantity=DBZH [#5@1]</div><div class="line">dataset1/data3/what:quantity=TH [#3@1]</div><div class="line">dataset1/data4/what:quantity=WRAD [#5@1]</div><div class="line">dataset1/quality1/what:quantity=QIND [#5@1]</div><div class="line">dataset1/quality2/what:quantity=CLASS [#6@1]</div><div class="line">dataset1/quality3/what:quantity=JAMMINGOP [#10@1]</div><div class="line">dataset1/quality4/what:quantity=SPECKLEOP [#10@1]</div><div class="line">...</div></div><!-- fragment --><p>Just like after running several <em>detection</em> processes, after reading files containing detection fields, global ie. elevation-specific quality data (<code>QIND</code> and <code>CLASS</code> ) are not implictly combined to local ie. quantity-specific quality data. As explained in detection , this combination takes place automatically if any removal command or <code>&ndash;c</code> &ndash;aQualityCombiner command is issued.</p>
<h1><a class="anchor" id="file_read_txt"></a>
Reading and writing text files</h1>
<p>Using <code>&ndash;outputFile</code> , the <em>structure</em> of the current data can be written as plain text in a file (*.txt) or to standard input (-): </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 -o volume.txt</div></div><!-- fragment --><p>File <code>volume.txt</code> will consist of lines of ODIM entries as follows: </p><div class="fragment"><div class="line">dataset1</div><div class="line">dataset1/data1</div><div class="line">dataset1/data1/data:image=500,360 [C@1]</div><div class="line">dataset1/data1/what:gain=0.5 [d1@8]</div><div class="line">dataset1/data1/what:nodata=255 [d1@8]</div><div class="line">dataset1/data1/what:offset=-32 [d1@8]</div><div class="line">dataset1/data1/what:quantity=TH [#3@1]</div><div class="line">dataset1/data1/what:undetect=0 [d1@8]</div><div class="line">dataset1/data1/how:LOG=2.5 [d1@8]</div><div class="line">dataset1/data2</div><div class="line">dataset1/data2/data:image=500,360 [C@1]</div><div class="line">dataset1/data2/what:gain=0.5 [d1@8]</div><div class="line">...</div></div><!-- fragment --><p>The storage types are indicated in the braces. The most frequent types are:</p>
<ul>
<li><code>#</code> - string</li>
<li><code>C</code> - unsigned character</li>
<li><code>S</code> - unsigned intereger</li>
<li><code>i</code> - integer (discouraged in ODIM)</li>
<li><code>l</code> - long integer</li>
<li><code>f</code> - float (discouraged in ODIM)</li>
<li><code>d</code> - double</li>
<li><code>*</code> - undefined</li>
</ul>
<p><b>Hint</b>. Based on metadata, it is often handy to automatically compose filenames. This is possible using <code>&ndash;expandVariables</code> as follows. </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --expandVariables -o <span class="stringliteral">&#39;incoming-${NOD}_${what:date}-${what:time}.txt&#39;</span></div></div><!-- fragment --><p> For using format templates and hadling multiple files on a single command line, see <a class="el" href="miscbook.html#templates">Metadata output using text templates</a>.</p>
<p>Volume can be also created using a text file like the one created above, that is, with the desired structure and data types. </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.txt -o volume-<span class="keyword">new</span>.h5</div></div><!-- fragment --><p>One can modify the metadata directly from the command line by means of <code>&ndash;setODIM</code> <code>&lt;path&gt;</code>:&lt;attribute&gt;=&lt;value&gt; command. The command has a special shorthand <code>&ndash;/&lt;path&gt;</code>:&lt;attribute&gt;=&lt;value&gt; . For example: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5   --/dataset1/how:myKey=myValue         -o volume-<span class="keyword">new</span>.h5</div><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5  <span class="stringliteral">&#39;--/dataset1/how:myKey=123.456 [d]&#39;</span>    -o volume-<span class="keyword">new</span>.h5</div><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5  <span class="stringliteral">&#39;--/dataset2/data3/what:quantity=PROB&#39;</span> -o volume-<span class="keyword">new</span>.h5</div></div><!-- fragment --><p> The second example shows how the storage type can be set in braces; to <code>double</code> in this case (see the list above). The default type is string (#). The third example illustrates how <code>PATH</code> can be a regexp; the attributes in the matching paths will be modified.</p>
<p>Hence, this feature can be used for completing incomplete ODIM metadata or adding arbitrary metadata. The actual radar data can be read or saved as image files as explained below.</p>
<h1><a class="anchor" id="file_io_img"></a>
Reading and writing image files</h1>
<p>Writing data to Portable Network Graphics (PNG) image format is carried out simply by using file extension "png", for example:</p>
<p>In addition, <b>Rack</b> provides support for writing Cartesian image data in Geo-Referenced Tagged Image File Format (GTIFF, GeoTIFF) format</p>
<p>Note: for unknown reasons, some projections &ndash; for example EPSG:3844, EPSG:3035, and EPSG:3995 &ndash; raise errors in writing projection data. (See <a class="el" href="compositespage.html">Cartesian conversions and composites</a> .)</p>
<p>Rack is also able to construct HDF5 from standard <b>png</b> image files. Each input image will be stored into the structure</p><ol type="1">
<li>in the first encountered <code>/data&lt;i&gt;</code> or <code>/quality&lt;i&gt;</code> group containing an empty <code>/data</code> (ie. uninitialized image), or if not found:</li>
<li>in a new <code>/data&lt;i&gt;/data</code> of the existing <code>/dataset&lt;j&gt;</code> with the highest index <code>j</code> </li>
</ol>
<p>Metadata can be set using commands or by inputting a text file as explained above. Metadata can be set before or after image inputs. Example: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.txt sweep1.png --/dataset1/data1/where:rscale=500  &lt;commands&gt;</div></div><!-- fragment --><p><code>Rack</code> also supports storing output data in <b>png</b> image format. A sweep may be stored as an image with: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5  -o sweep.png</div></div><!-- fragment --><p> By default, <code>&ndash;outputFile</code> (<code>-o</code>) command selects the first dataset encountered in the data structure, typically <code>/data1/dataset1/data</code> .</p>
<div class="image">
<img src="sweep.png" alt="sweep.png"/>
<div class="caption">
An image generated with <code>-o</code> .</div></div>
 <p>The set of source data can be limited with the data selection command <code>&ndash;select</code> . </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --select data=3 -o sweep-other.png</div></div><!-- fragment --><p> Notice that a literal is also a regular expression, so a path as such can be given as well.</p>
<p>Metadata (ODIM variables) are written in the comment lines. The syntax follows that of a text dump produced with <code>&ndash;outputFile</code> .</p>
<p><b>Rack</b> can also save all the data sets in separate files, producing <code>sweep000.png</code> , <code>sweep001.png</code> and so on. This is achieved with <code>&ndash;outputRawImages</code> , abbreviated -O . The command stores the image data directly, without rescaling pixel values.</p>
<h2><a class="anchor" id="graphs"></a>
Illustrating data structure</h2>
<p><b>Rack</b> can be also used to output the tree-like hierarchy of radar data in <code>dot</code> format (<a href="http://www.graphviz.org/documentation/">http://www.graphviz.org/documentation/</a>). From that format, one may use Graphviz <code>dot</code> program to produce tree graphs in various image formats link <code>png</code> , <code>pdf</code> and <code>svg</code>. For example:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 -o volume-tree.dot</div><div class="line">dot volume-tree.dot -Tpng -o volume-tree.png</div><div class="line">dot volume-tree.dot -Tpdf -o volume-tree.pdf</div></div><!-- fragment --><p>The desired group types can be selected with <code>&ndash;select</code> groups=[...] , among which most relevant are <code>DATASET=2</code> , and <code>DATA=4</code> , and <code>QUALITY=8</code> . In the current version, no other parameters that <code>groups</code> are supported. (See <a class="el" href="index.html#selecting">Selecting data</a> .)</p>
 <div class="image">
<img src="volume-trees.png" alt="volume-trees.png"/>
<div class="caption">
Data structure illustrations creating by means of <code>dot</code> file output.</div></div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
