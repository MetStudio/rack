<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rack: Accumulation products</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="rack.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rack-logo-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><!-- rack /-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Accumulation products </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#acc_polar">Accumulation products</a></li>
<li class="level2"><a href="#create_cluttermap">Application: creating clutter maps</a></li>
<li class="level2"><a href="#acc_cart">Accumulating Cartesian data</a></li>
</ul>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="acc_polar"></a>
Accumulation products</h1>
<p><b>Rack</b> can be used to accumulate polar and Cartesian data - raw data or products. Cumulative rainfall or clutter maps are examples of accumulation products than can be generated.</p>
<p>Internally, the accumulation process uses the same modules as in compositing: an accumulation array is first updated, and finally an accumulation product is extracted.</p>
<h2><a class="anchor" id="acc_polar"></a>
Accumulation products</h2>
<p>Basically, data in polar coordinates (ie. sweeps or polar products) can be accumulated to an array by issuing input files proceded with <code>&ndash;pAdd</code> command, one by one. More conveniently the command is set with <code>&ndash;script</code> and the inputs are given as a list. Finally, the accumulated data is extracted with <code>&ndash;pExtract</code> . For example: <br  />
</p>
<div class="fragment"><div class="line"><span class="preprocessor"># &#39;Undetect&#39; values replaced with physical low value</span></div>
<div class="line"><a class="code" href="namespacerack.html">rack</a>                    --script <span class="stringliteral">&#39;--pAdd&#39;</span> data-acc/2017*.h5 --encoding C --pExtract <span class="stringliteral">&#39;dw&#39;</span> -o accumulated0.h5</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># &#39;Undetect&#39; values discarded</span></div>
<div class="line"><span class="preprocessor">rack --undetectWeight 0 --script &#39;--pAdd&#39; data-acc/2017*.h5 --encoding C --pExtract &#39;dw&#39; -o accumulated1.h5</span></div>
</div><!-- fragment --><div class="image">
<img src="acc-input.png" alt="" width="0.9\textwidth"/>
<div class="caption">
Input data for accumulation (<code>DBZH</code> ).</div></div>
 <p>Like in compositing, bins marked <code>undetect</code> can be either replaced with physical values (set with <code>&ndash;quantityConf</code> ) or discarded (with <code>&ndash;undetectWeight</code> 0 ).</p>
<div class="image">
<img src="accumulated-both.png" alt=""/>
<div class="caption">
Result of accumulation: with (left) or without (right) <code>undetect</code> replacement (-32dBZ).</div></div>
 <p>The desired data storage type and encoding can be set with <code>&ndash;encoding</code> command. Issuing it explicitly (before <code>&ndash;pAdd</code> command) prevents warnings of a limited value range.</p>
<p>Accumulation can be incremental, that is, one may continue accumulation on a previously computed result. The new data will be assigned weight 1/N which normalizes the accumulation. <br  />
 For example, the above set of 25 volumes can be accumulated as follows, as monthly sets: </p><div class="fragment"><div class="line"><span class="preprocessor"># Cold start</span></div>
<div class="line"><a class="code" href="namespacerack.html">rack</a> --undetectWeight 0 --script <span class="stringliteral">&#39;--pAdd&#39;</span>        data-acc/20170[2-5]*.h5 --pExtract <span class="stringliteral">&#39;dw&#39;</span> -o acc-part.h5</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Warm start: read previous accumulation as a background</span></div>
<div class="line"><span class="preprocessor">rack --undetectWeight 0 --script &#39;--pAdd&#39; acc-part.h5 data-acc/201706*.h5     --pExtract &#39;dw&#39; -o accumulated.h5</span></div>
</div><!-- fragment --><p>By default, quantities <code>DBZH</code> and <code>RATE</code> are used for accumulation. This can be changed with <code>&ndash;select</code> . For example, accumulation of total reflectivity (<code>TH</code> ) is obtained with: <br  />
 </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> --encoding S --select <span class="stringliteral">&#39;quantity=^TH$&#39;</span> --script <span class="stringliteral">&#39;--pAdd&#39;</span> &lt;files&gt;  --pExtract <span class="stringliteral">&#39;dw&#39;</span> -o accumulated.h5 </div>
</div><!-- fragment --><h2><a class="anchor" id="create_cluttermap"></a>
Application: creating clutter maps</h2>
<p>As can be seen from above images, accumulating data without quality control produces anomalies in results, especially wind turbines and other clutter that has not been removed even by Doppler filtering. Utility script <code>make-cluttermap.sh</code> accumulates data and creates a clutter map applicable with anomaly detection command <code>&ndash;aClutter</code> (<a class="el" href="andrepage.html#aClutter">Detecting ground clutter</a>) . The accumulation part is similar to the processes described above. After obtaining the accumulated <code>DBZH</code> field it can converted to <code>CLUTTER</code> for example as follows:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> accumulated0.h5 -Q DBZH --encoding C,0.004,-0.004,quantity=CLUTTER --iFuzzyStep -20:20 --keep quantity=CLUTTER -o cluttermap.h5</div>
</div><!-- fragment --><p>One can say that the above command practically <em>defines</em> a clutter map. In other words, <b>Rack</b> contains no built-in support in creating <code>CLUTTER</code> quantity but the user may use general purpose commands as above to produce a clutter map. In this example, the accumulated <code>DBZH</code> data is simply rescaled by a fuzzy mapping and the quantity label is changed to <code>CLUTTER</code>. Other fuzzy functions can be considered as well (see <code>&ndash;iFuzzy</code> prefixed commands in <a class="el" href="imagespage.html#imageOps">List of image operators</a>).</p>
<p>The above command appends the <code>CLUTTER</code> data group in the file. The original <code>DBZH</code> group can be removed with <code>&ndash;keep</code> <code>quantity=CLUTTER</code> . Further, in batches generating clutter maps for several radar sites the filenames can be automatically derived by using <code>&ndash;expandVariables</code> followed by filenames containing implicit variables like 'cluttermaps/clutterMap-${NOD}.h5'. (See <a class="el" href="miscbook.html#templates">Metadata output using text templates</a> for details).</p>
<h2><a class="anchor" id="acc_cart"></a>
Accumulating Cartesian data</h2>
<p>Accumulating data that has already been projected to a Cartesian coordinate system can be accumulated using <code>&ndash;cAdd</code> command . This process is technically similar to compositing; now a single radar is repeatedly "composited" on itself.</p>
<p>(Under construction.) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespacerack_html"><div class="ttname"><a href="namespacerack.html">rack</a></div><div class="ttdef"><b>Definition:</b> AndreOp.cpp:46</div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
