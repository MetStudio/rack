<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Variable-example.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="rack.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rack-logo-110x55.png"/></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Variable-example.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>An object for storing scalars, vectors and std::string using automatic type conversions. Variable designed for storing values with automatic forward and backward conversion. Internally, Variable uses a byte vector which is dynamically resized. The data can be a single scalar value, an array, or a string.</p>
<p>Internally, a string is implemented as a vector of chars. This is different from <a class="el" href="classdrain_1_1Castable.html">drain::Castable</a> with type std::string which assumes that the object behind (void *) is actually an instance of std::string.</p>
<p>The following examples illustrates its usage: </p><div class="fragment"><div class="line">Variable vField;</div><div class="line">vField = 123.456;  <span class="comment">// First assignment sets the type implicitly (here double).</span></div><div class="line"><span class="keywordtype">int</span> i = vField;    <span class="comment">// Automatic cast</span></div></div><!-- fragment --><p>The type of a Variable can be set explicitly: </p><div class="fragment"><div class="line">Variable vField;</div><div class="line">vField.setType&lt;std::string&gt;();</div><div class="line">vField = 123.456; <span class="comment">// Stored internally as char array &quot;123.456&quot;</span></div><div class="line"><span class="keywordtype">int</span> i = vField;   <span class="comment">// Automatic cast</span></div></div><!-- fragment --><p>Any number of scalars can be appended to a Variable, which hence becomes a vector: </p><div class="fragment"><div class="line">Variable vField;</div><div class="line">vField.setType&lt;<span class="keywordtype">double</span>&gt;();</div><div class="line">vField &lt;&lt; 1.0 &lt;&lt; 123.456 &lt;&lt; 9.999;</div><div class="line">std::cout &lt;&lt; vField &lt;&lt; std::endl;  <span class="comment">// dumps 1.0,123.456,9.999</span></div></div><!-- fragment --><p>If the type is unset, Variable converts to undetectValue or an empty std::string. </p><div class="fragment"><div class="line">Variable vField;</div><div class="line"><span class="keywordtype">double</span> d = vField; <span class="comment">// becomes 0.0</span></div><div class="line">std::string s = vField; <span class="comment">// becomes &quot;&quot;</span></div></div><!-- fragment --><p>Unlike with <a class="el" href="classdrain_1_1Castable.html">drain::Castable</a>, the pointer contained by Variable is not visible or changeable by the user.</p>
<p>Note: tried skipping Castable, inheriting directly from Caster but needs Castable for cooperation with ReferenceMap.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    Copyright 2001 - 2017  Markus Peura, Finnish Meteorological Institute (First.Last@fmi.fi)</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    This file is part of Rack for C++.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    Rack is free software: you can redistribute it and/or modify</span></div><div class="line"><span class="comment">    it under the terms of the GNU Lesser Public License as published by</span></div><div class="line"><span class="comment">    the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><span class="comment">    any later version.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    Rack is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment">    GNU Lesser Public License for more details.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    You should have received a copy of the GNU General Public License</span></div><div class="line"><span class="comment">    along with Rack.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">   REQUIRE:  drain/util/{Caster,Castable,JSONwriter,Log,RegExp,Sprinter,String,Type,Variable}.cpp</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">    g ++ -I. drain/examples/Variable-example.cpp  drain/util/{Caster,Castable,JSONwriter,RegExp,String,Type,Variable}.cpp -o Variable-example</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;drain/util/Variable.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;drain/util/VariableMap.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> S, <span class="keyword">class</span> T&gt;</div><div class="line"><span class="keywordtype">void</span> demo(<span class="keyword">const</span> T &amp; value){</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Input &quot;</span> &lt;&lt; value &lt;&lt; <span class="stringliteral">&quot;Â [&quot;</span> &lt;&lt; drain::Type::getTypeChar(<span class="keyword">typeid</span>(T));</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;] =&gt; Variable [&quot;</span> &lt;&lt; drain::Type::getTypeChar(<span class="keyword">typeid</span>(S)) &lt;&lt; <span class="stringliteral">&quot;] -&gt; &quot;</span>;</div><div class="line">    std::cout &lt;&lt; drain::Type::getTypeChar(<span class="keyword">typeid</span>(T)) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"></div><div class="line">    <a name="_a0"></a><a class="code" href="classdrain_1_1Variable.html">drain::Variable</a> v(<span class="keyword">typeid</span>(S));</div><div class="line">    <span class="comment">//std::cout &lt;&lt; &quot;Variable: \n&quot;;</span></div><div class="line">    <span class="comment">//v.toJSON(std::cout, &#39;\n&#39;);</span></div><div class="line">    v = value;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Variable: \n&quot;</span>;</div><div class="line">    <span class="comment">//v.toJSON(std::cout, &#39;\n&#39;);</span></div><div class="line">    <span class="comment">//std::cout.width(5);</span></div><div class="line">    std::cout.precision(8);</div><div class="line">    v.<a name="a1"></a>toJSON(std::cout);</div><div class="line"></div><div class="line">    T x = v;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Restored: &quot;</span> &lt;&lt; x &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line">    std::cout &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"></div><div class="line">    <span class="comment">//exit(-1);</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (argc &gt; 1){</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;argc; ++i){</div><div class="line"></div><div class="line">            <span class="keyword">const</span> <span class="keywordtype">char</span> *s = argv[i];</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Arg &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;:\t&quot;</span> &lt;&lt; s;</div><div class="line">            std::list&lt;std::string&gt; l;</div><div class="line">            <a name="a2"></a><a class="code" href="classdrain_1_1StringTools.html#a2db9bd0c715bd792f29acc36a015646a">drain::StringTools::split</a>(s, l, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot; (smells like [&quot;</span> &lt;&lt; drain::Type::getTypeChar(<a name="a3"></a><a class="code" href="classdrain_1_1Type.html#a3b15f55b35a4382dd6edb1046bb19818">drain::Type::guessArrayType</a>(l)) &lt;&lt; <span class="stringliteral">&quot;]) \n\n&quot;</span>;</div><div class="line"></div><div class="line"></div><div class="line">            std::string str(s);</div><div class="line">            <span class="keywordtype">int</span> k = atoi(s);</div><div class="line">            <span class="keywordtype">double</span> d = atof(s);</div><div class="line"></div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;---------\n&quot;</span>;</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Storage type: STRING\n&quot;</span>;</div><div class="line">            demo&lt;std::string&gt;(str);</div><div class="line">            demo&lt;std::string&gt;(k);</div><div class="line">            demo&lt;std::string&gt;(d);</div><div class="line"></div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;---------\n&quot;</span>;</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Storage type: BOOL\n&quot;</span>;</div><div class="line">            demo&lt;bool&gt;(str);</div><div class="line">            demo&lt;bool&gt;(k);</div><div class="line">            demo&lt;bool&gt;(d);</div><div class="line"></div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;---------\n&quot;</span>;</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Storage type: INT\n&quot;</span>;</div><div class="line">            demo&lt;int&gt;(str);</div><div class="line">            demo&lt;int&gt;(k);</div><div class="line">            demo&lt;int&gt;(d);</div><div class="line"></div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;---------\n&quot;</span>;</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Storage type: DOUBLE\n&quot;</span>;</div><div class="line">            demo&lt;double&gt;(str);</div><div class="line">            demo&lt;double&gt;(k);</div><div class="line">            demo&lt;double&gt;(d);</div><div class="line"></div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Demonstrates storing values to Castables and Referencers.\n&quot;</span>;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Usage:\n  &quot;</span>   &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; &lt;input1&gt; &lt;input2&gt; ... ]\n&quot;</span>;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Example:\n  &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; 123.45  456.678E+12  Ãland ... ]\n&quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">//drain::Variable v; // (typeid(double));</span></div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Initialization without setting type.\n&quot;</span>;</div><div class="line">    <a class="code" href="classdrain_1_1Variable.html">drain::Variable</a> v;</div><div class="line">    v.<a name="a4"></a>toStream(std::cout);</div><div class="line">    v.toJSON(std::cout, <span class="charliteral">&#39;\n&#39;</span>); <span class="comment">// Dumps information to stdout.</span></div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Assign double. Type will be automatically set.\n&quot;</span>;</div><div class="line">    v = 12.345678901234567890;</div><div class="line">    v.toJSON(std::cout, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Restore to str::string :\n&quot;</span>;</div><div class="line">    std::string x = v;</div><div class="line">    std::cout &lt;&lt; x;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Initialization with another Variable.\n&quot;</span>;</div><div class="line">    <a class="code" href="classdrain_1_1Variable.html">drain::Variable</a> v2(v);  <span class="comment">// Copy const. Type and value are copied.</span></div><div class="line">    <span class="comment">//v.toStream(std::cout);std::cout &lt;&lt; &quot;\n\n&quot;;</span></div><div class="line">    v2 = v;                 <span class="comment">// Assignment. Type is set, if initially unset.</span></div><div class="line">    v2.toJSON();</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">//std::cout &lt;&lt; &quot;Sets type to std::string (clears the contents, initializes with empty std::string.\n&quot;;</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Sets type to std::string (clears the contents, initializes with empty array.\n&quot;</span>;</div><div class="line">    v.<a name="a5"></a><a class="code" href="classdrain_1_1Variable.html#aa5d02202c1f07e573b97647425fde328">setType</a>(<span class="keyword">typeid</span>(std::string));</div><div class="line">    v.toJSON();</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Append with default inputSeparator &#39;,&#39;\n&quot;</span>;</div><div class="line">    v &lt;&lt; <span class="stringliteral">&quot;Hello&quot;</span> &lt;&lt; <span class="stringliteral">&quot;world&quot;</span> &lt;&lt; <span class="stringliteral">&quot;everybody!&quot;</span>; <span class="comment">// Now appends with separator &quot;,&quot;.</span></div><div class="line">    v.toJSON(); <span class="comment">// &quot;Hello,world&quot;</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Append further, now without inputSeparator\n&quot;</span>;</div><div class="line">    v.<a name="a6"></a><a class="code" href="classdrain_1_1Castable.html#af6753cf50487545556d5a117f3af7e1d">setInputSeparator</a>(<span class="charliteral">&#39;\0&#39;</span>);</div><div class="line">    v &lt;&lt; 1.23f &lt;&lt; 4.56 &lt;&lt; <span class="stringliteral">&quot;7.89&quot;</span>;</div><div class="line">    <span class="comment">//v.setSeparator(&#39;,&#39;);</span></div><div class="line">    v.toJSON();  <span class="comment">// Contents: &quot;Hello,world1.234.566.789&quot;</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">//return 1;</span></div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Clear, set inputSeparator(,) and re-assign:&quot;</span>;</div><div class="line">    v.<a name="a7"></a><a class="code" href="classdrain_1_1Castable.html#ac8bb3912a3ce86b15842e79d0b421204">clear</a>(); <span class="comment">// Type is still std::string.</span></div><div class="line">    v.<a class="code" href="classdrain_1_1Castable.html#af6753cf50487545556d5a117f3af7e1d">setInputSeparator</a>(<span class="charliteral">&#39;,&#39;</span>);</div><div class="line">    v &lt;&lt; 1.23f &lt;&lt; 4.56 &lt;&lt; <span class="stringliteral">&quot;7.89&quot;</span>; <span class="comment">// Now appends as std::strings, with separator &quot;,&quot;.</span></div><div class="line">    v.toJSON();  <span class="comment">// Contents: &quot;1.23,4.56,7.89&quot;</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Assignment to another Variable.\n&quot;</span>;</div><div class="line">    v2.<a class="code" href="classdrain_1_1Variable.html#aa5d02202c1f07e573b97647425fde328">setType</a>(<span class="keyword">typeid</span>(<span class="keywordtype">float</span>));</div><div class="line">    v2 = <span class="stringliteral">&quot;0.1,0.2,0.3&quot;</span>;</div><div class="line">    v2.toJSON();  <span class="comment">// Contents: 1.23, 4.56, 7.89</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line">    v2 = v;</div><div class="line">    v2.toJSON();  <span class="comment">// Contents: 1.23, 4.56, 7.89</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Assignment from a Castable.\n&quot;</span>;</div><div class="line">    <span class="keywordtype">double</span> d = 123.4567;</div><div class="line">    <a name="_a8"></a><a class="code" href="classdrain_1_1Castable.html">drain::Castable</a> castable(d);</div><div class="line">    d = 123.456;</div><div class="line">    v.<a class="code" href="classdrain_1_1Variable.html#aa5d02202c1f07e573b97647425fde328">setType</a>(<span class="keyword">typeid</span>(<span class="keywordtype">int</span>));</div><div class="line">    v = castable;</div><div class="line">    v.toJSON();  <span class="comment">// Contents: 1.23, 4.56, 7.89</span></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Convert type to int.\n&quot;</span>;</div><div class="line">    v.<a class="code" href="classdrain_1_1Variable.html#aa5d02202c1f07e573b97647425fde328">setType</a>(<span class="keyword">typeid</span>(<span class="keywordtype">int</span>));</div><div class="line">    v.toJSON();</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Assignment from a Castable.\n&quot;</span>;</div><div class="line">    <a name="_a9"></a><a class="code" href="classdrain_1_1VariableMap.html">drain::VariableMap</a> m;</div><div class="line">    m[<span class="stringliteral">&quot;first&quot;</span>] = 2.0/3.0;</div><div class="line">    m[<span class="stringliteral">&quot;second&quot;</span>] = v2;</div><div class="line">    std::cout &lt;&lt; m &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line">    m[<span class="stringliteral">&quot;first&quot;</span>].<a name="a10"></a><a class="code" href="classdrain_1_1SmartMap.html#a6ee6f4170909a5a214dfd44ab218e3ff">toJSON</a>();</div><div class="line">    m[<span class="stringliteral">&quot;second&quot;</span>].toJSON();</div><div class="line"></div><div class="line">    v.<a class="code" href="classdrain_1_1Castable.html#ac8bb3912a3ce86b15842e79d0b421204">clear</a>();</div><div class="line">    v.<a class="code" href="classdrain_1_1Variable.html#aa5d02202c1f07e573b97647425fde328">setType</a>(<span class="keyword">typeid</span>(std::string));</div><div class="line">    v = <span class="stringliteral">&quot;123.456&quot;</span>;</div><div class="line">    <span class="keywordtype">double</span> x2 = v;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;x2 &quot;</span> &lt;&lt; x2 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line">    x2 = v;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;x2 &quot;</span> &lt;&lt; x2 &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"></div><div class="line">    std::vector&lt;int&gt; vect;</div><div class="line">    <a class="code" href="classdrain_1_1Variable.html">drain::Variable</a>(<span class="stringliteral">&quot;0,1,2,3&quot;</span>, <span class="keyword">typeid</span>(<span class="keywordtype">float</span>)).<a name="a11"></a><a class="code" href="classdrain_1_1Castable.html#ab25247e405d9bd5c7e8cffd0ddf5fc8a">toSequence</a>(vect);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
